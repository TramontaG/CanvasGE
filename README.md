# Sliver Engine

Pre-alpha TypeScript/HTML5 Canvas 2D game engine.

## Install
`npm install sliver-engine`

## Usage
```ts
import {
  CanvasController,
  Game,
  Scene,
  SceneManager,
  SoundManager,
} from "sliver-engine";

const canvas = new CanvasController(800, 600);

const mainScene = new Scene("main", "#0b0a18");
const scenes = new SceneManager({ main: mainScene }, mainScene);

const game = new Game({
  canvas,
  scenes,
  soundManager: new SoundManager(),
  ticksPerSecond: 60,
});

game.start();
```

Sliver Engine appends the `<canvas>` to `#canvas-container` if present, otherwise to `document.body`.

## Engine features (Sliver Engine)
- **Game loop + context**: tick/render split, configurable TPS, shared `GameContext` (tick/frame counters, pressed keys, message bus, sound manager).
- **Saves**: base64-encoded save files stored in `localStorage`, with `onLoadSaveFile(save => ...)` callback during `game.setup()`.
- **Scenes**: scene stack, per-scene camera offset, background fill, opacity + overlay, gravity, and transitions (fade/slide/flash with easing).
- **Rendering**: `CanvasController` + `ShapeDrawer` for primitives/text, clipping and rotation helpers, font loading, and sprite + sprite-sheet support (frame rendering, scaling, mirroring) with `renderSprite` / `renderSpriteAnimation` helpers.
- **Input/events**: keyboard + mouse + wheel events, propagation control, and ergonomic decorators (`@onClick`, `@onMouseRelease`, `@onHover`, `@onStopHovering`, `@onMouseWheel`, `@onMouseWheelOverHitbox`, `@onKeyPressed`/combo, `@onChildrenEvents`, `@grabbable()`).
- **Game objects**: `GameObject` base with tick/render hooks, child hierarchy, relative positioning, opacity/rotation, simple movement via `speed`, and helpers to change scenes / publish messages / query keys.
- **Hitboxes + collisions**: circle + (rotatable) square hitboxes, point checks, “will intersect” checks, debug rendering, and collision resolution with restitution + friction and immovable bodies.
- **Audio**: `SoundManager` (Web Audio) with preload, master gain, per-sound volume, looping, playback-rate, and start/end/duration controls.
- **Reusable object/widgets**: `Button`, `Text`, `ScrollView` (clipping + scrollbar + wheel), `FloatingView` (rise + fade), `ShowOnHover`, `Group`, `SceneTranslator`, and basic shape helpers (`ClickableShape`, `HoverableShape`).

## Repository layout
- `src/` – Engine sources.
- `src/index.ts` – Library entrypoint (exports the public API).
- `dist/` – Build output (generated by `npm run build`).
- `src/CanvasController` – Canvas primitives, font loading, sprite + sprite-sheet helpers.
- `src/Context` – `GameContext` + message bus.
- `src/Events` – Event types, dispatcher, decorators, and `KeyAccumulator`.
- `src/Game` – Game loop orchestration.
- `src/GameObject` – `GameObject`, hitboxes/collisions, sprite render decorators, and reusable widgets.
- `src/Scenes` – `Scene` + `SceneManager` and transition helpers.
- `src/SoundManager` – Web Audio wrapper.
- `src/Lib` – Utilities (`Vector`, `MinHeap`, `PathfindingProxy`, ...).
- `src/Assets` – Shape render helpers (arrow/chevrons).

## Running locally
1) Install deps: `npm install`
2) Typecheck: `npm run typecheck`
3) Build: `npm run build`

## Extending
- Add a scene by instantiating `Scene` and registering it in `SceneManager` (see how `src/LamenEmpire/index.ts` wires scenes today).
- Create a game object by subclassing `GameObject`, adding hitboxes, and using decorators like `@onClick` / `@onHover` / `@onKeyPressed`.
- Use `GameContext` from objects to switch/push/pop/transition scenes, publish/subscribe messages, query pressed keys, and play sounds.
- Save/load game state using `game.saves` (or `context.getGame().saves` from a `GameObject`).

## Saving & loading
- Create a save: `const id = game.saves.create({ ...anySerializableState }, { label: "slot 1" });`
- List saves: `game.saves.list()`
- Read a save: `const save = game.saves.read(id)`
- Load hook (runs during `game.setup()`): `game.onLoadSaveFile((save) => { /* restore state */ });`

## Notes
- Browser-only (DOM + Canvas + Web Audio).
- Building requires a modern Node.js (TypeScript 5).
- If you use the decorator helpers, enable `experimentalDecorators: true` in your TS config.
- `src/LamenEmpire` is a dogfooding game and is excluded from the published npm package.
